<div ng-controller="ForumPageCtrl" ng-init="initForumCtrl()" ng-cloak>

    <div ng-if="isForumLoaded">

        <div ng-controller="HeaderCtrl"
             ng-init="initHeaderCtrl(name, '#/')"
             header-template>
        </div>

        <style>
            .addTopicBox span.subjectTooLong
            {
                color: red;
            }

            .addTopicBox span.subjectLengthOk
            {
                color: green;
            }

            .addTopicBox input.subjectTooLong
            {
                background-color: red;
            }

            .addTopicBox img
            {
                max-width: 650px;
                max-height: 350px;
            }

            div.topicBox a
            {
                text-decoration: none;
                color: black;
            }

            .topicBoxUpdated
            {
                background-color: lightgreen;
            }

            .clickable
            {
                cursor: pointer;
            }
        </style>

        <div ng-controller="AddTopicCtrl"
             ng-init="initAddTopicCtrl()"
             class="addTopicBox"
             ng-cloak>

            <button ng-if="collapsed" class="btn btn-info" ng-click="showButtonClicked()">Create Topic</button>

            <div ng-if="!collapsed">
                <div class="form-group">
                    <input type="text"
                           placeholder="Topic subject"
                           style="width: 100%; padding: 5px;"
                           ng-model="newSubject.value"
                           ng-class="newSubject.value.length > subjectMaxLength ? 'subjectTooLong' : 'subjectLengthOk'"/>
                </div>
                <div class="form-group">
                    <div placeholder="Topic post"
                         style="width: 100%;"
                         ng-model="newText.value"
                         text-angular
                         ta-toolbar="[['p','pre','quote'],['bold','italics','underline'],['ul','ol'],['undo','redo'],['insertLink','insertImage']]">
                    </div>
                </div>
                <button class="btn btn-success" ng-click="addButtonClicked(newSubject.value)">Create Topic</button>
                <button class="btn btn-warning" ng-click="cancelButtonClicked()">Cancel</button>
            </div>

        </div>

        <br/>

        <div ng-if="topics.length == 0">
            <p>There are not topics yet in this forum. Why not be the first to create one?</p>
        </div>

        <div ng-repeat="topic in topics">

            <div ng-controller="TopicListCtrl"
                 ng-init="initTopicListCtrl(topic)"
                 ng-cloak
                 class="well topicBox"
                 ng-class="{topicBoxUpdated: isRecentlyUpdated}">

                <div class="postContainer">
                    <div>
                        <i ng-if="isRecentlyUpdated"
                           ng-click="markTopicAsReadClicked()"
                           class="fa fa-star clickable"
                           style="color: green;"
                           popover="Mark as read"
                           popover-trigger="mouseenter"
                           popover-append-to-body="true"
                           popover-placement="bottom"></i>
                        <a href="#/{{ forumId }}/topics/{{ topic.topicId }}"><span><b>{{ topic.subject }}</b></span></a>
                    </div>
                    <div>
                        <span>{{ topic.creator }},
                            <span popover="{{ topic.createDate | date: 'EEE MMM d, y' }} at {{ topic.createDate | date: 'H:mm' }}"
                                  popover-trigger="mouseenter"
                                  popover-append-to-body="true"
                                  popover-placement="right"
                                  am-time-ago="topic.createDate"></span>
                        </span>
                    </div>
                </div>

            </div>

        </div>

    </div>

</div>