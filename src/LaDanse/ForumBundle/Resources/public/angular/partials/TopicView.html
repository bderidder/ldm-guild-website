<div ng-controller="TopicPageCtrl" ng-init="initTopicPageCtrl()" ng-cloak>

    <style>

        .postBox img
        {
            max-width: 650px;
            max-height: 350px;
        }

        a.editPostLink
        {
            cursor: pointer;
        }

        .topicContainer .postRow
        {
            margin-top: 20px;
            margin-bottom: 20px;
            border-bottom: 1px solid gray;
        }

        .topicContainer .postBoxNew
        {
        }

    </style>

    <div ng-if="isTopicLoaded"
         class="container-fluid topicContainer">

        <div class="row">

            <div ng-controller="HeaderCtrl"
                 ng-init="initHeaderCtrl(subject, '#/' + forumId)"
                 ng-if="isTopicLoaded"
                 class="col-md-12"
                 header-template>
            </div>

        </div>

        <div class="row">

            <div ng-controller="AddPostCtrl"
                 ng-init="initAddPostCtrl()"
                 class="col-md-12"
                 ng-cloak>

                <button ng-if="collapsed" class="btn btn-info" ng-click="showButtonClicked()">Add A Reply</button>

                <div ng-if="!collapsed">
                    <div ng-controller="PostEditorCtrl"
                         ng-init="initPostEditorCtrl('', 'Add A Reply', savePostEditor, cancelPostEditor)"
                         post-editor-template>
                    </div>
                </div>

            </div>

        </div>

        <div ng-repeat="post in posts"
             ng-controller="PostCtrl"
             ng-init="initPostCtrl(post)"
             class="row postRow">

            <div class="col-md-2">
                <p>
                    <i ng-if="isNew"
                       class="fa fa-star" style="color: green;"></i>
                    <b>{{ post.poster }}</b>&nbsp;
                    <a class="editPostLink"
                       ng-if="!isEditing && canUserEdit()"
                       ng-click="editRequested()"
                       popover="Edit this post"
                       popover-trigger="mouseenter"
                       popover-append-to-body="true"
                       popover-placement="bottom">
                        <i class="fa fa-pencil fa-1x"></i></a>
                </p>
                <p>
                    <span popover="{{ post.postDate | date: 'EEE MMM d, y' }} at {{ post.postDate | date: 'H:mm' }}"
                          popover-trigger="mouseenter"
                          popover-append-to-body="true"
                          popover-placement="bottom">{{ post.postDate | date: 'MMM d H:mm' }}
                    </span>
                </p>
                <p ng-if="isNew"
                   ng-click="markAsReadClicked()"
                   style="cursor: pointer; font-size: 0.9em;">
                    mark as read
                </p>

            </div>

            <div class="col-md-10"
                 ng-switch="isEditing">

                <div class="postBox well"
                     ng-class="{postBoxNew: isNew}"
                     ng-switch-when="false">
                    <div ng-bind-html="post.message"></div>
                </div>
                <div class="postBox well"
                     ng-switch-when="true">
                    <div ng-controller="PostEditorCtrl"
                         ng-init="initPostEditorCtrl(post.message, 'Update Reply', savePostEditor, cancelPostEditor)"
                         post-editor-template>
                    </div>
                </div>


            </div>

        </div>

    </div>

</div>