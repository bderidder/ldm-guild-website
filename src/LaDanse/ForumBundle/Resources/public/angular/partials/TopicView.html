<div ng-controller="TopicPageCtrl" ng-init="initTopicPageCtrl()" ng-cloak>

    <div ng-if="isTopicLoaded">

        <div ng-controller="HeaderCtrl"
             ng-init="initHeaderCtrl(subject, '#/' + forumId)"
             ng-if="isTopicLoaded"
             header-template>
        </div>

        <div ng-controller="AddPostCtrl"
             ng-init="initAddPostCtrl()"
             ng-cloak>

            <button ng-if="collapsed" class="btn btn-info" ng-click="showButtonClicked()">Add A Reply</button>

            <div collapse="collapsed">
                <div ng-controller="PostEditorCtrl"
                     ng-init="initPostEditorCtrl('', savePostEditor, cancelPostEditor)"
                     post-editor-template>
                </div>
            </div>

        </div>

        <br/>

        <div ng-repeat="post in posts">

            <div ng-controller="PostCtrl"
                 ng-init="initPostCtrl(post)"
                 ng-switch="isEditing">

                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12" style="margin-bottom: 10px">
                            <b>{{ post.poster }}</b> on
                            <span popover="{{ post.postDate | date: 'EEE MMM d, y' }} at {{ post.postDate | date: 'H:mm' }}"
                                  popover-trigger="mouseenter"
                                  popover-append-to-body="true"
                                  popover-placement="top">{{ post.postDate | date: 'MMM d' }}
                            </span>
                                &nbsp;<a ng-if="!isEditing" ng-click="editRequested()"><i class="fa fa-pencil fa-1x"></i></a>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 well"
                             ng-switch-when="false"
                             ng-bind-html="post.message"></div>
                        <div class="col-md-12 well"
                             ng-switch-when="true">
                            <div ng-controller="PostEditorCtrl"
                                 ng-init="initPostEditorCtrl(post.message, savePostEditor, cancelPostEditor)"
                                 post-editor-template>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

        </div>

        <br/>

    </div>

</div>

</div>