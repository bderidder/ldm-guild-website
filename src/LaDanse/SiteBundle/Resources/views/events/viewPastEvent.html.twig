{% extends 'LaDanseSiteBundle:layout:layout2.html.twig' %}

{% block title %}Event - La Danse Macabre{% endblock %}

{% block body %}

    <div style="position: absolute; left: -90px;">
        <a href="{{ path('calendarIndex') }}">
            <img src="{{ asset('bundles/ladansesite/images/LeftArrow.png') }}" style="height: 70px;" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Cancel and back to calendar" />
        </a>
    </div>

    <h1 style="padding-top: 10px;">{{ event.name }}</h1>

    <br/>

    <div class="alert alert-danger">
        <div style="text-align: center; font-size: 150%">
            This event is in the past!<br/>
            Nothing can be changed, you can only comment.
        </div>
    </div>

    <div class="container-fluid" style="padding-top: 15px;">
        <div class="row">
            <div class="col-md-4">
                <p class="event-label">Organised by {{ event.organiser.displayName }}</p>
                <p>{{ event.description }}</p>
            </div>
            
            <div class="col-md-2">
                <div class="event-label-container">
                    <p class="event-label">When</p>
                    <p>{{ event.inviteTime|date("d/m (D)") }}</p>
                </div>
            </div>
            <div class="col-md-2">
                <div class="event-label-container">
                    <p class="event-label">Invite Time</p>
                    <p>{{ event.inviteTime|date("H:i") }}</p>
                </div>
            </div>
            <div class="col-md-2">
                <div class="event-label-container">
                    <p class="event-label">Start Time</p>
                    <p>{{ event.startTime|date("H:i") }}</p>
                </div>
            </div>
            <div class="col-md-2">
                <div class="event-label-container">
                    <p class="event-label">End Time</p>
                    <p>{{ event.endTime|date("H:i") }}</p>
                </div>
            </div>
        </div>
    </div>

    <br/>

    <h4>Sign Ups</h4>
 
    {% if (event.signUps.willComeCount != 0) 
        or (event.signUps.mightComeCount != 0) 
        or (event.signUps.absentCount != 0) %}    

        <table class="table table-condensed" style="width: auto;">
            <tr>
                <th>&nbsp;</th>
                <th class="center-td">Tank</th>
                <th class="center-td">Healer</th>
                <th class="center-td">Damage</th>
            </tr>

            {# render 'will come' sign ups, if any #}
            {% for signUp in event.signUps.willComeSignUps %}
                {% if signUp.currentUser %}
                <tr class="active">
                {% else %} 
                <tr>   
                {% endif %}
                    <td>{{ signUp.account.displayName }}</td>
                    <td class="center-td">
                        {% if signUp.signedAsTank %}<i class="signUp fa fa-times fa-1x text-success"
                                data-url="{{ path('listClaims', 
                                    {'eventId': event.id,
                                     'accountId': signUp.account.id,
                                     'role': 'DPS'}) }}"></i>{% endif %}
                    </td>
                    <td class="center-td">
                        {% if signUp.signedAsHealer %}<i class="signUp fa fa-times fa-1x text-success"
                                data-url="{{ path('listClaims', 
                                    {'eventId': event.id,
                                     'accountId': signUp.account.id,
                                     'role': 'DPS'}) }}"></i>{% endif %}
                    </td>
                    <td class="center-td">
                        {% if signUp.signedAsDamage %}<i class="signUp fa fa-times fa-1x text-success"
                                data-url="{{ path('listClaims', 
                                    {'eventId': event.id,
                                     'accountId': signUp.account.id,
                                     'role': 'DPS'}) }}"></i>{% endif %}
                    </td>
                </tr>
            {% endfor %}

            {# render 'might come' sign ups, if any #}
            {% for signUp in event.signUps.mightComeSignUps %}
                {% if signUp.currentUser %}
                <tr class="active">
                {% else %} 
                <tr>   
                {% endif %}
                    <td>{{ signUp.account.displayName }}</td>
                    <td class="center-td">
                        {% if signUp.signedAsTank %}<i class="signUp fa fa-question fa-1x text-warning"
                                data-url="{{ path('listClaims', 
                                    {'eventId': event.id,
                                     'accountId': signUp.account.id,
                                     'role': 'DPS'}) }}"></i>{% endif %}
                    </td>
                    <td class="center-td">
                        {% if signUp.signedAsHealer %}<i class="signUp fa fa-question fa-1x text-warning"
                                data-url="{{ path('listClaims', 
                                    {'eventId': event.id,
                                     'accountId': signUp.account.id,
                                     'role': 'DPS'}) }}"></i>{% endif %}
                    </td>
                    <td class="center-td">
                        {% if signUp.signedAsDamage %}<i class="signUp fa fa-question fa-1x text-warning"
                                data-url="{{ path('listClaims', 
                                    {'eventId': event.id,
                                     'accountId': signUp.account.id,
                                     'role': 'DPS'}) }}"></i>{% endif %}
                    </td>
                </tr>
            {% endfor %}

            {# render 'absent' sign ups, if any #}
            {% for signUp in event.signUps.absentSignUps %}
                {% if signUp.currentUser %}
                <tr class="active">
                {% else %} 
                <tr>   
                {% endif %}
                    <td>{{ signUp.account.displayName }}</td>
                    <td class="center-td" colspan="3">
                        <i class="text-danger">can't come</i>
                    </td>
                </tr>
            {% endfor %}
        </table>

    {% else %}    
        <p>There were no sign ups for this event. 
            Since this event is in the past, no new sign ups can be made.</p>
    {% endif %}

    <br/>

    <h4>Comments</h4>

    {# placeholder for comments, content is supplied by jQuery scripts #}
    <div id="TopicContainer">
    </div>
    
{% endblock %}

{% block javascript %}

    {# make sure that any content of the 'javascript' block in parent templates is rendered as well #}
    {{ parent() }}

    <script>
        $(document).ready(function()
        {
            $('i.signUp').each(function()
            {
                $(this).qtip(
                {
                    content: {
                        text: function(event, api) 
                        {
                            $.ajax({
                                url: api.elements.target.attr('data-url') // Use href attribute as URL
                            })
                            .then(function(content) {
                                // Set the tooltip content upon successful retrieval
                                api.set('content.text', content);
                            }, function(xhr, status, error) {
                                // Upon failure... set the tooltip content to error
                                api.set('content.text', status + ': ' + error);
                            });
                
                            return 'Loading...'; // Set some initial text
                        }
                    },
                    position: {
                        viewport: $(window)
                    },
                    style: 'qtip-bootstrap'
                });
            });
        });
    </script>

    {% include 'LaDanseSiteBundle:events:eventForum.html.twig' %}

{% endblock %}