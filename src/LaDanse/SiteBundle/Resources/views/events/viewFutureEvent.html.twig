{% extends 'LaDanseSiteBundle:layout:page.html.twig' %}

{% block title %}Raid - La Danse Macabre{% endblock %}

{% block body %}

    <ol class="breadcrumb">
        <li><a href="{{ path('welcomeIndex') }}">Home</a></li>
        <li><a href="{{ path('calendarIndex') }}">Calendar</a></li>
        <li class="active">Event '{{ event.name }}' - {{ event.inviteTime|date("d/m (D)") }}</li>
    </ol>

    <h1>{{ event.name }}</h1>

    <div class="container-fluid" style="padding-top: 15px;">
        <div class="row">
            <div class="col-md-4">
                <p class="event-label">Organised by {{ event.organiser.name }}</p>
                <p>{{ event.description }}</p>
            </div>
            
            <div class="col-md-2">
                <div class="event-label-container">
                    <p class="event-label">When</p>
                    <p>{{ event.inviteTime|date("d/m (D)") }}</p>
                </div>
            </div>
            <div class="col-md-2">
                <div class="event-label-container">
                    <p class="event-label">Invite Time</p>
                    <p>{{ event.inviteTime|date("H:i") }}</p>
                </div>
            </div>
            <div class="col-md-2">
                <div class="event-label-container">
                    <p class="event-label">Start Time</p>
                    <p>{{ event.startTime|date("H:i") }}</p>
                </div>
            </div>
            <div class="col-md-2">
                <div class="event-label-container">
                    <p class="event-label">End Time</p>
                    <p>{{ event.endTime|date("H:i") }}</p>
                </div>
            </div>
        </div>
    </div>

    <br/>

    <h4>Sign Ups</h4>

    {# render all sign ups if at least one exists #}
    {% if (event.signUps.willComeCount != 0) 
        or (event.signUps.mightComeCount != 0) 
        or (event.signUps.absentCount != 0) %}   

        <table class="table table-condensed" style="width: auto;">
            <tr>
                <th>&nbsp;</th>
                <th class="center-td">Tank</th>
                <th class="center-td">Healer</th>
                <th class="center-td">Damage</th>
                <th><!-- remove --></th>
            </tr>

            {# render 'will come' sign ups, if any #}
            {% for signUp in event.signUps.willComeSignUps %}
                {% if signUp.currentUser %}
                <tr class="active">
                {% else %} 
                <tr>   
                {% endif %}
                    <td>{{ signUp.account.name }}</td>
                    <td class="center-td">
                        {% if signUp.signedAsTank %}<i class="fa fa-times fa-1x text-success" data-accountId="14"></i>{% endif %}
                    </td>
                    <td class="center-td">
                        {% if signUp.signedAsHealer %}<i class="fa fa-times fa-1x text-success" data-accountId="14"></i>{% endif %}
                    </td>
                    <td class="center-td">
                        {% if signUp.signedAsDamage %}<i class="fa fa-times fa-1x text-success" data-accountId="14"></i>{% endif %}
                    </td>
                    <td>
                        {% if signUp.currentUser %}
                            <a id="removeWillComeSignUp" href="{{ path('removeSignUp', {'id': event.id}) }}">Remove</a>
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}

            {# render 'might come' sign ups, if any #}
            {% for signUp in event.signUps.mightComeSignUps %}
                {% if signUp.currentUser %}
                <tr class="active">
                {% else %} 
                <tr>   
                {% endif %}
                    <td>{{ signUp.account.name }}</td>
                    <td class="center-td">
                        {% if signUp.signedAsTank %}<i class="fa fa-question fa-1x text-warning" data-accountId="14"></i>{% endif %}
                    </td>
                    <td class="center-td">
                        {% if signUp.signedAsHealer %}<i class="fa fa-question fa-1x text-warning" data-accountId="14"></i>{% endif %}
                    </td>
                    <td class="center-td">
                        {% if signUp.signedAsDamage %}<i class="fa fa-question fa-1x text-warning" data-accountId="14"></i>{% endif %}
                    </td>
                    <td>
                        {% if signUp.currentUser %}
                            <a id="removeWillComeSignUp" href="{{ path('removeSignUp', {'id': event.id}) }}">Remove</a>
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}

            {# render 'absent' sign ups, if any #}
            {% for signUp in event.signUps.absentSignUps %}
                {% if signUp.currentUser %}
                <tr class="active">
                {% else %} 
                <tr>   
                {% endif %}
                    <td>{{ signUp.account.name }}</td>
                    <td class="center-td" colspan="3">
                        <i class="text-danger">can't come</i>
                    </td>
                    <td>
                        {% if signUp.currentUser %}
                            <a id="removeWillComeSignUp" href="{{ path('removeSignUp', {'id': event.id}) }}">Remove</a>
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}

        </table>

        {# if the currently logged in user is not signed up yet, invite to do so #}
        {% if (not event.signUps.currentUserSignedUp) and auth.currentContext.authenticated %}
            <p>You seemed to have forgotten to sign up for this event! Please <a href="{{ path('createSignUp', {'id': event.id}) }}">sign up</a> or inform us of your <a href="{{ path('createAbsence', {'id': event.id}) }}">absence</a>.</p>
        {% endif %}
    
    {# no sign ups, invite the user to make one or inform about absence #}
    {% else %}    
        <p>There are no sign ups, <a href="{{ path('createSignUp', {'id': event.id}) }}">why not be the first</a> ... or inform us of your <a href="{{ path('createAbsence', {'id': event.id}) }}">absence</a>?</p>
    {% endif %}

    {# if the currently logged in user is the organiser, edit and delete options are shown #}
    {% if event.isOrganiser and auth.currentContext.authenticated %}
        <p>As an organiser you can <a href="{{ path('editEvent', {'id': event.id}) }}">edit</a> this event or <a  id="removeEvent" href="{{ path('removeEvent', {'id': event.id}) }}">delete</a> it.</p> 
    {% endif %}

    <br/>

    <h4>Comments</h4>

    {# placeholder for comments, content is supplied by jQuery scripts #}
    <div id="TopicContainer">
    </div>
    
{% endblock %}

{% block javascript %}

    {# make sure that any content of the 'javascript' block in parent templates is rendered as well #}
    {{ parent() }}

    <script type="application/javascript">
        $(document).ready(function()
        {
            $("#removeWillComeSignUp").click(function()
            {
                alertify.confirm('This will remove your sign up, are you sure?', 
                    function (e) 
                    {
                        if (e) 
                        {
                            location.assign('{{ path('removeSignUp', {'id': event.id}) }}');
                        } 
                    }
                );

                return false;
            });

            $("#removeEvent").click(function()
            {
                alertify.confirm('This will remove the event, are you sure?', 
                    function (e) 
                    {
                        if (e) 
                        {
                            location.assign('{{ path('removeEvent', {'id': event.id}) }}');
                        } 
                    }
                );

                return false;
            });
         });
    </script>

    {% include 'LaDanseSiteBundle:events:eventForum.html.twig' %}

{% endblock %}